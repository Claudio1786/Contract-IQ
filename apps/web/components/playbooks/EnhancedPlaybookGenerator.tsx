'use client';\n\nimport React, { useState } from 'react';\nimport { Button, Card, Input } from '../ui';\nimport { \n  enhancedScenarios, \n  negotiationIntelligenceDB, \n  buildEnhancedPrompt,\n  type ObjectiveIntelligence \n} from '../../lib/negotiation-intelligence';\n\nexport interface NegotiationPlaybook {\n  id: string;\n  title: string;\n  contractType: string;\n  scenario: string;\n  objectives: string[];\n  talkingPoints: Array<{\n    topic: string;\n    position: string;\n    rationale: string;\n    fallback?: string;\n  }>;\n  riskMitigation: Array<{\n    risk: string;\n    mitigation: string;\n    priority: 'high' | 'medium' | 'low';\n  }>;\n  tactics: Array<{\n    tactic: string;\n    description: string;\n    whenToUse: string;\n  }>;\n  timeline: Array<{\n    phase: string;\n    duration: string;\n    activities: string[];\n  }>;\n  successMetrics: string[];\n  createdAt: Date;\n}\n\nexport interface EnhancedPlaybookGeneratorProps {\n  onPlaybookGenerated?: (playbook: NegotiationPlaybook, metadata?: any) => void;\n  className?: string;\n}\n\nexport const EnhancedPlaybookGenerator: React.FC<EnhancedPlaybookGeneratorProps> = ({\n  onPlaybookGenerated,\n  className = ''\n}) => {\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [useMultiLLM, setUseMultiLLM] = useState(true);\n  const [formData, setFormData] = useState({\n    contractType: '',\n    scenario: '',\n    objectives: [] as string[],\n    currentTerms: '',\n    desiredOutcome: '',\n    modelPreference: 'auto-select' as 'auto-select' | 'openai' | 'gemini' | 'cross-validate'\n  });\n\n  const contractTypes = [\n    'SaaS Agreement',\n    'Service Contract',\n    'Equipment Lease',\n    'Professional Services',\n    'Data Processing Agreement',\n    'Software License',\n    'Consulting Agreement',\n    'Master Service Agreement'\n  ];\n\n  const handleInputChange = (field: keyof typeof formData, value: any) => {\n    setFormData(prev => ({\n      ...prev,\n      [field]: value\n    }));\n  };\n\n  const toggleObjective = (objectiveId: string) => {\n    setFormData(prev => ({\n      ...prev,\n      objectives: prev.objectives.includes(objectiveId)\n        ? prev.objectives.filter(id => id !== objectiveId)\n        : [...prev.objectives, objectiveId]\n    }));\n  };\n\n  const generatePlaybook = async () => {\n    setIsGenerating(true);\n    \n    try {\n      // Choose API endpoint based on multi-LLM preference\n      const apiEndpoint = useMultiLLM ? '/api/generate-playbook-multi-llm' : '/api/generate-playbook';\n      \n      console.log(`ü§ñ Using ${useMultiLLM ? 'Multi-LLM' : 'Gemini-only'} approach...`);\n      console.log('Model Preference:', formData.modelPreference);\n      \n      const response = await fetch(apiEndpoint, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          contractType: formData.contractType,\n          scenario: formData.scenario,\n          objectives: formData.objectives,\n          currentTerms: formData.currentTerms,\n          desiredOutcome: formData.desiredOutcome,\n          modelPreference: formData.modelPreference,\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error(`API Error: ${response.status}`);\n      }\n\n      const data = await response.json();\n      \n      if (!data.success) {\n        throw new Error(data.error || 'Failed to generate playbook');\n      }\n\n      console.log('‚úÖ Enhanced playbook generated successfully!');\n      console.log('Metadata:', data.metadata);\n      \n      if (data.metadata?.crossValidation) {\n        console.log('üîç Cross-validation results:', data.metadata.crossValidation);\n      }\n      \n      setIsGenerating(false);\n      onPlaybookGenerated?.(data.playbook, data.metadata);\n      \n    } catch (error: any) {\n      console.error('‚ùå Error generating enhanced playbook:', error);\n      setIsGenerating(false);\n      \n      alert(`Failed to generate playbook: ${error.message}`);\n    }\n  };\n\n  const isFormValid = formData.contractType && formData.scenario && formData.objectives.length > 0;\n\n  // Get available objectives for the selected scenario\n  const getAvailableObjectives = (): ObjectiveIntelligence[] => {\n    if (!formData.scenario) return [];\n    \n    const scenarioData = negotiationIntelligenceDB[formData.scenario as keyof typeof negotiationIntelligenceDB];\n    return scenarioData?.objectiveIntelligence || [];\n  };\n\n  return (\n    <div className={`space-y-8 ${className}`}>\n      {/* Enhanced Header with Multi-LLM Toggle */}\n      <div className=\"text-center space-y-4\">\n        <div className=\"flex justify-between items-center\">\n          <h1 className=\"text-3xl font-bold text-gray-900\">Enhanced Playbook Generator</h1>\n          \n          {/* Multi-LLM Toggle */}\n          <div className=\"flex items-center space-x-3\">\n            <span className=\"text-sm font-medium text-gray-700\">Multi-LLM Mode</span>\n            <button\n              type=\"button\"\n              className={`relative inline-flex h-6 w-11 shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-600 focus:ring-offset-2 ${\n                useMultiLLM ? 'bg-indigo-600' : 'bg-gray-200'\n              }`}\n              role=\"switch\"\n              aria-checked={useMultiLLM}\n              onClick={() => setUseMultiLLM(!useMultiLLM)}\n            >\n              <span className=\"sr-only\">Use Multi-LLM approach</span>\n              <span\n                aria-hidden=\"true\"\n                className={`pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out ${\n                  useMultiLLM ? 'translate-x-5' : 'translate-x-0'\n                }`}\n              />\n            </button>\n          </div>\n        </div>\n        \n        <p className=\"text-gray-600 max-w-2xl mx-auto\">\n          {useMultiLLM \n            ? 'Generate advanced negotiation playbooks using both Google Gemini and OpenAI models for optimal results' \n            : 'Generate negotiation playbooks using Google Gemini AI'\n          }\n        </p>\n        \n        {useMultiLLM && (\n          <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-3 max-w-2xl mx-auto\">\n            <p className=\"text-sm text-blue-800\">\n              <span className=\"font-medium\">Multi-LLM Benefits:</span> Cross-validation, model-specific optimization, and enhanced accuracy\n            </p>\n          </div>\n        )}\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n        {/* Enhanced Form Column */}\n        <div className=\"space-y-6\">\n          <Card>\n            <Card.Header>\n              <Card.Title>Contract Details</Card.Title>\n            </Card.Header>\n            <Card.Content className=\"space-y-6\">\n              {/* Contract Type Selection */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Contract Type *\n                </label>\n                <select\n                  value={formData.contractType}\n                  onChange={(e) => handleInputChange('contractType', e.target.value)}\n                  className=\"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                  required\n                >\n                  <option value=\"\">Select contract type...</option>\n                  {contractTypes.map(type => (\n                    <option key={type} value={type}>{type}</option>\n                  ))}\n                </select>\n              </div>\n\n              {/* Scenario Selection */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Negotiation Scenario *\n                </label>\n                <select\n                  value={formData.scenario}\n                  onChange={(e) => handleInputChange('scenario', e.target.value)}\n                  className=\"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                  required\n                >\n                  <option value=\"\">Select scenario...</option>\n                  {Object.entries(enhancedScenarios).map(([key, scenario]) => (\n                    <option key={key} value={key}>\n                      {scenario.displayName}\n                    </option>\n                  ))}\n                </select>\n              </div>\n\n              {/* Model Preference (Multi-LLM mode only) */}\n              {useMultiLLM && (\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    AI Model Preference\n                  </label>\n                  <select\n                    value={formData.modelPreference}\n                    onChange={(e) => handleInputChange('modelPreference', e.target.value as any)}\n                    className=\"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                  >\n                    <option value=\"auto-select\">Auto-Select (Recommended)</option>\n                    <option value=\"openai\">Prefer OpenAI (Creative reasoning)</option>\n                    <option value=\"gemini\">Prefer Gemini (Structured analysis)</option>\n                    <option value=\"cross-validate\">Cross-Validate (Highest accuracy)</option>\n                  </select>\n                  <p className=\"text-xs text-gray-500 mt-1\">\n                    Auto-select chooses the optimal model based on scenario type\n                  </p>\n                </div>\n              )}\n\n              {/* Current Terms */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Current Contract Terms\n                </label>\n                <textarea\n                  value={formData.currentTerms}\n                  onChange={(e) => handleInputChange('currentTerms', e.target.value)}\n                  className=\"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                  rows={4}\n                  placeholder=\"Describe the current terms you're working with...\"\n                />\n              </div>\n\n              {/* Desired Outcome */}\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Desired Outcome\n                </label>\n                <textarea\n                  value={formData.desiredOutcome}\n                  onChange={(e) => handleInputChange('desiredOutcome', e.target.value)}\n                  className=\"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                  rows={3}\n                  placeholder=\"What specific outcomes are you trying to achieve?\"\n                />\n              </div>\n            </Card.Content>\n          </Card>\n        </div>\n\n        {/* Objectives Column */}\n        <div className=\"space-y-6\">\n          <Card>\n            <Card.Header>\n              <Card.Title>Negotiation Objectives *</Card.Title>\n              <p className=\"text-sm text-gray-600\">\n                Select your primary negotiation objectives. Intelligence-driven recommendations will be included.\n              </p>\n            </Card.Header>\n            <Card.Content>\n              {formData.scenario ? (\n                <div className=\"space-y-3\">\n                  {getAvailableObjectives().map((objective) => (\n                    <label\n                      key={objective.id}\n                      className=\"flex items-start space-x-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer\"\n                    >\n                      <input\n                        type=\"checkbox\"\n                        checked={formData.objectives.includes(objective.id)}\n                        onChange={() => toggleObjective(objective.id)}\n                        className=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded mt-1\"\n                      />\n                      <div className=\"flex-1\">\n                        <div className=\"font-medium text-gray-900\">{objective.title}</div>\n                        <div className=\"text-sm text-gray-600\">{objective.description}</div>\n                        {objective.marketIntelligence && (\n                          <div className=\"text-xs text-blue-600 mt-1\">\n                            üí° {objective.marketIntelligence.slice(0, 100)}...\n                          </div>\n                        )}\n                      </div>\n                    </label>\n                  ))}\n                </div>\n              ) : (\n                <p className=\"text-gray-500 text-center py-8\">\n                  Please select a scenario to see available objectives\n                </p>\n              )}\n            </Card.Content>\n          </Card>\n\n          {/* Generate Button */}\n          <Button\n            onClick={generatePlaybook}\n            disabled={!isFormValid || isGenerating}\n            className=\"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-4 px-6 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed\"\n            size=\"lg\"\n          >\n            {isGenerating ? (\n              <div className=\"flex items-center justify-center space-x-2\">\n                <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white\"></div>\n                <span>\n                  {useMultiLLM ? 'Generating with Multi-LLM...' : 'Generating with Gemini...'}\n                </span>\n              </div>\n            ) : (\n              <div className=\"flex items-center justify-center space-x-2\">\n                <span>üöÄ</span>\n                <span>\n                  Generate {useMultiLLM ? 'Enhanced' : 'Standard'} Playbook\n                </span>\n              </div>\n            )}\n          </Button>\n\n          {formData.objectives.length > 0 && (\n            <div className=\"text-sm text-green-600 text-center\">\n              ‚úì {formData.objectives.length} objective{formData.objectives.length > 1 ? 's' : ''} selected\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Feature Comparison */}\n      {useMultiLLM && (\n        <Card>\n          <Card.Header>\n            <Card.Title>Multi-LLM Advantages</Card.Title>\n          </Card.Header>\n          <Card.Content>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n              <div className=\"text-center\">\n                <div className=\"text-2xl mb-2\">üéØ</div>\n                <h3 className=\"font-medium text-gray-900 mb-2\">Optimal Model Selection</h3>\n                <p className=\"text-sm text-gray-600\">\n                  Automatically chooses the best AI model for each scenario type\n                </p>\n              </div>\n              <div className=\"text-center\">\n                <div className=\"text-2xl mb-2\">üîç</div>\n                <h3 className=\"font-medium text-gray-900 mb-2\">Cross-Validation</h3>\n                <p className=\"text-sm text-gray-600\">\n                  Validates results across multiple models for higher accuracy\n                </p>\n              </div>\n              <div className=\"text-center\">\n                <div className=\"text-2xl mb-2\">üí∞</div>\n                <h3 className=\"font-medium text-gray-900 mb-2\">Cost Transparency</h3>\n                <p className=\"text-sm text-gray-600\">\n                  Real-time cost tracking and optimization recommendations\n                </p>\n              </div>\n            </div>\n          </Card.Content>\n        </Card>\n      )}\n    </div>\n  );\n};\n\nexport default EnhancedPlaybookGenerator;\n"